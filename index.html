<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CatMind â€” ×œ×”×‘×™×Ÿ ××ª ×”×—×ª×•×œ</title>
  <meta name="description" content="×›×œ×™ ××™× ×˜×¨××§×˜×™×‘×™ ×©××ª×¨×’× ×”×ª× ×”×’×•×ª ×—×ª×•×œ×™× ×œ×”×‘× ×” ××¢×©×™×ª ×•×ª×•×›× ×™×ª ×¤×¢×•×œ×”." />
  <meta http-equiv="Cache-Control" content="no-store" />
  <style>
    :root{
      --bg:#070a0f;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.08);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --line:rgba(255,255,255,.12);
      --accent:#20e3b2;
      --accent2:#ffb86b;
      --danger:#ff5c7a;
      --ok:#7CFF7A;
      --shadow: 0 20px 70px rgba(0,0,0,.45);
      --radius:20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background: radial-gradient(1200px 800px at 70% 10%, rgba(32,227,178,.12), transparent 55%),
                  radial-gradient(900px 600px at 15% 35%, rgba(255,184,107,.10), transparent 60%),
                  linear-gradient(180deg, #05070c, #070a0f 45%, #05070c);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Hebrew", sans-serif;
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{
      min-height:100%;
      display:flex;
      flex-direction:column;
      position:relative;
      isolation:isolate;
    }

    /* Background particles canvas */
    #fx{
      position:fixed;
      inset:0;
      z-index:-2;
      pointer-events:none;
      opacity:.95;
    }

    /* Soft vignette */
    .vignette{
      position:fixed;
      inset:-40px;
      z-index:-1;
      pointer-events:none;
      background:
        radial-gradient(60% 55% at 50% 38%, transparent 30%, rgba(0,0,0,.45) 72%, rgba(0,0,0,.72) 100%);
    }

    header{
      padding:22px 18px 10px;
      display:flex;
      justify-content:center;
    }
    .topbar{
      width:min(1100px, 100%);
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border:1px solid var(--line);
      border-radius:999px;
      background:rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 40px rgba(0,0,0,.25);
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      min-width:220px;
    }
    .logo{
      width:42px;height:42px;
      border-radius:14px;
      background:
        radial-gradient(circle at 35% 35%, rgba(255,255,255,.22), transparent 55%),
        linear-gradient(135deg, rgba(32,227,178,.9), rgba(255,184,107,.85));
      box-shadow: 0 14px 40px rgba(32,227,178,.15);
      position:relative;
      overflow:hidden;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,.35), transparent 55%);
      transform: rotate(25deg);
    }
    .brand h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
      line-height:1.1;
    }
    .brand small{
      display:block;
      margin-top:3px;
      color:var(--muted);
      font-size:12px;
      font-weight:500;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
    }
    .pill label{
      font-size:12px;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
    }
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:700;
      font-size:12px;
      transition: transform .08s ease, border-color .2s ease, background .2s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(32,227,178,.35)}
    .btn:active{transform: translateY(0px) scale(.99)}
    .btn.primary{
      border-color: rgba(32,227,178,.35);
      background: linear-gradient(180deg, rgba(32,227,178,.18), rgba(255,255,255,.03));
    }

    main{
      width:min(1100px, 100%);
      margin:0 auto;
      padding: 14px 18px 44px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
    }
    @media (max-width: 980px){
      main{grid-template-columns:1fr; padding-bottom:60px}
      .brand{min-width:auto}
    }

    .card{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card .inner{padding:18px}
    .title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:18px 18px 12px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
    }
    .title h2{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .title p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }

    /* Hero: cat eyes */
    .hero{
      min-height:260px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      position:relative;
      overflow:hidden;
    }
    .heroBg{
      position:absolute;
      inset:0;
      background:
        radial-gradient(600px 420px at 70% 35%, rgba(32,227,178,.18), transparent 60%),
        radial-gradient(520px 380px at 25% 60%, rgba(255,184,107,.16), transparent 65%),
        linear-gradient(180deg, rgba(0,0,0,.20), rgba(0,0,0,.06));
      filter:saturate(1.1);
      opacity:.95;
    }
    .hero .inner{position:relative; z-index:1}
    .hero h3{
      margin:0;
      font-size:24px;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .hero .sub{
      margin:10px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
      max-width: 56ch;
    }
    .heroFooter{
      position:relative;
      z-index:1;
      padding:0 18px 18px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:var(--muted);
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.55), rgba(32,227,178,.85));
      box-shadow: 0 0 18px rgba(32,227,178,.28);
    }

    .eyesWrap{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      z-index:1;
      pointer-events:none;
      opacity:.95;
    }
    .eyes{
      display:flex;
      gap:34px;
      transform: translateY(14px);
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.35));
    }
    .eye{
      width:120px;
      height:70px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 45%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.18);
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(6px);
    }
    .eye:before{
      content:"";
      position:absolute; inset:-35%;
      background: radial-gradient(circle at 50% 50%, rgba(0,0,0,.35), transparent 55%);
      transform: rotate(18deg);
      opacity:.35;
    }
    .iris{
      position:absolute;
      width:42px;height:42px;
      border-radius:50%;
      top:50%; left:50%;
      transform: translate(-50%,-50%);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 42%),
        radial-gradient(circle at 50% 50%, rgba(32,227,178,.95), rgba(32,227,178,.25) 62%, rgba(0,0,0,.2) 100%);
      box-shadow: 0 0 24px rgba(32,227,178,.25);
    }
    .pupil{
      position:absolute;
      width:10px; height:28px;
      border-radius:999px;
      background: rgba(0,0,0,.85);
      top:50%; left:50%;
      transform: translate(-50%,-50%);
      box-shadow: 0 0 0 2px rgba(255,255,255,.04);
    }
    .shine{
      position:absolute;
      width:10px;height:10px;border-radius:50%;
      background: rgba(255,255,255,.75);
      top:32%; left:35%;
      filter: blur(.2px);
    }

    /* Form */
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width: 680px){ .grid{grid-template-columns:1fr} }

    .field{
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
    }
    .field label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:8px;
      user-select:none;
    }
    select, input[type="text"], textarea{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color:var(--text);
      padding:12px 12px;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:110px; resize:vertical}
    select:focus, input:focus, textarea:focus{border-color: rgba(32,227,178,.45); box-shadow:0 0 0 3px rgba(32,227,178,.12)}

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-start;
      margin-top:12px;
    }

    /* Results */
    .resultBox{
      border-top:1px solid var(--line);
      padding:16px 18px 18px;
      display:none;
    }
    .resultBox.show{display:block}
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .chip{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
    }
    .section{
      margin-top:14px;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
    }
    .section h4{margin:0 0 8px; font-size:13px}
    .section ul{margin:0; padding:0 18px; color:var(--text); line-height:1.65}
    .section li{margin:6px 0}
    .kpi{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:12px;
    }
    .kpi .k{
      flex:1;
      min-width:170px;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
    }
    .k .label{color:var(--muted); font-size:12px}
    .k .val{font-weight:900; font-size:18px; margin-top:6px}
    .val.ok{color:var(--ok)}
    .val.bad{color:var(--danger)}
    footer{
      width:min(1100px, 100%);
      margin:0 auto;
      padding: 0 18px 26px;
      color: rgba(255,255,255,.55);
      font-size:12px;
      line-height:1.6;
    }
    .fine{
      opacity:.9;
      border-top:1px solid rgba(255,255,255,.10);
      padding-top:16px;
    }

    /* Toggle */
    .switch{
      width:44px; height:26px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      position:relative;
      cursor:pointer;
      flex:0 0 auto;
    }
    .switch:after{
      content:"";
      position:absolute;
      top:50%;
      right:4px;
      width:18px; height:18px;
      border-radius:50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,.80);
      box-shadow: 0 8px 18px rgba(0,0,0,.28);
      transition: right .18s ease, background .18s ease;
    }
    .switch.on{
      border-color: rgba(32,227,178,.35);
      background: rgba(32,227,178,.18);
    }
    .switch.on:after{
      right:22px;
      background: rgba(32,227,178,.95);
    }

    /* Small helpers */
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .hide{display:none!important}
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <div class="vignette"></div>

  <div class="wrap">
    <header>
      <div class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>CatMind</h1>
            <small>×œ×”×‘×™×Ÿ ×”×ª× ×”×’×•×ª ×—×ª×•×œ×™× â€” ×•×œ×”×—×–×™×¨ ×©×§×˜ ×œ×‘×™×ª</small>
          </div>
        </div>

        <div class="controls">
          <div class="pill" title="××•×–×™×§×ª ×¨×§×¢ (××¤×©×¨ ×’× ×œ×”×¢×œ×•×ª MP3 ××”××—×©×‘)">
            <label for="audioFile">××•×–×™×§×”</label>
            <input id="audioFile" type="file" accept="audio/*" style="max-width:180px" />
            <button class="btn" id="playBtn" type="button">Play</button>
            <button class="btn" id="muteBtn" type="button">Mute</button>
          </div>

          <div class="pill" title="××¤×§×˜ ×—×œ×§×™×§×™× ×‘×¨×§×¢">
            <label>×—×œ×§×™×§×™×</label>
            <div class="switch on" id="fxToggle" role="switch" aria-checked="true" tabindex="0"></div>
          </div>

          <button class="btn primary" id="demoBtn" type="button">×“××• ××”×™×¨</button>
        </div>
      </div>
    </header>

    <main>
      <!-- Left: Analyzer -->
      <section class="card">
        <div class="title">
          <div>
            <h2>××‘×—×•×Ÿ ××”×™×¨ + ×ª×•×›× ×™×ª ×¤×¢×•×œ×”</h2>
            <p>×‘×—×¨ ××¦×‘, ×’×™×œ ×•×¡×‘×™×‘×” â€” ×•×§×‘×œ ×›×™×•×•×Ÿ ×”×¡×ª×‘×¨×•×ª×™ + ×¦×¢×“×™× ×™×•××™×™×.</p>
          </div>
          <div class="badge"><span class="dot"></span>×›×œ×™ ××™× ×˜×¨××§×˜×™×‘×™</div>
        </div>

        <div class="inner">
          <div class="grid">
            <div class="field">
              <label for="issue">××” ×”×‘×¢×™×” ×”×¢×™×§×¨×™×ª?</label>
              <select id="issue">
                <option value="bite">× ×©×™×›×•×ª ×‘×–××Ÿ ×œ×™×˜×•×£ / ××©×—×§</option>
                <option value="night">×™×œ×œ×•×ª / ×¨×™×¦×” ×‘×œ×™×œ×”</option>
                <option value="litter">×”×©×ª× ×”/×¦×•××” ××—×•×¥ ×œ××¨×’×–</option>
                <option value="aggression">×ª×•×§×¤× ×•×ª ×œ×—×ª×•×œ×™×/×× ×©×™×</option>
                <option value="stress">×¡×˜×¨×¡ / ××ª×—×‘××ª / ×œ× ××•×›×œ×ª ×›×¨×’×™×œ</option>
                <option value="scratch">×©×™×¨×•×˜ ×¨×”×™×˜×™×</option>
              </select>
            </div>

            <div class="field">
              <label for="age">×’×™×œ ×”×—×ª×•×œ</label>
              <select id="age">
                <option value="kitten">×’×•×¨ (×¢×“ ×©× ×”)</option>
                <option value="adult" selected>×‘×•×’×¨ (1â€“7)</option>
                <option value="senior">××‘×•×’×¨ (7+)</option>
              </select>
            </div>

            <div class="field">
              <label for="home">×¡×‘×™×‘×”</label>
              <select id="home">
                <option value="small">×“×™×¨×” ×§×˜× ×”</option>
                <option value="apt" selected>×“×™×¨×” ×¨×’×™×œ×”</option>
                <option value="house">×‘×™×ª ×¢× ×—×¦×¨</option>
              </select>
            </div>

            <div class="field">
              <label for="others">×™×© ×¢×•×“ ×—×™×•×ª ×‘×‘×™×ª?</label>
              <select id="others">
                <option value="none" selected>×œ×</option>
                <option value="cat">×›×Ÿ â€” ×—×ª×•×œ × ×•×¡×£</option>
                <option value="dog">×›×Ÿ â€” ×›×œ×‘</option>
                <option value="multi">×›×Ÿ â€” ×›××” ×—×™×•×ª</option>
              </select>
            </div>
          </div>

          <div class="field" style="margin-top:12px">
            <label for="details">×ª××¨ ×‘××©×¤×˜ ××” ×§×•×¨×” (××•×¤×¦×™×•× ×œ×™)</label>
            <textarea id="details" placeholder="×“×•×’××”: ×”×•× × ×•×©×š ××—×¨×™ 10 ×©× ×™×•×ª ×œ×™×˜×•×£, ×‘×¢×™×§×¨ ×‘×¢×¨×‘..."></textarea>
          </div>

          <div class="actions">
            <button class="btn primary" id="analyzeBtn" type="button">× ×ª×— ×¢×›×©×™×•</button>
            <button class="btn" id="resetBtn" type="button">××™×¤×•×¡</button>
          </div>
        </div>

        <div class="resultBox" id="resultBox">
          <div class="kpi">
            <div class="k">
              <div class="label">××‘×—× ×” ××•×‘×™×œ×”</div>
              <div class="val ok" id="diagTop">â€”</div>
            </div>
            <div class="k">
              <div class="label">×¨××ª ×“×—×™×¤×•×ª</div>
              <div class="val" id="urgency">â€”</div>
            </div>
            <div class="k">
              <div class="label">×¡×‘×™×¨×•×ª (×”×¢×¨×›×”)</div>
              <div class="val mono" id="confidence">â€”</div>
            </div>
          </div>

          <div class="chips" id="chips"></div>

          <div class="section">
            <h4>××” ×–×” ×›× ×¨××” ××•××¨</h4>
            <div id="meaning" style="color:var(--muted); line-height:1.7"></div>
          </div>

          <div class="section">
            <h4>×ª×•×›× ×™×ª ×¤×¢×•×œ×” ×œ-72 ×©×¢×•×ª</h4>
            <ul id="plan72"></ul>
          </div>

          <div class="section">
            <h4>×ª×•×›× ×™×ª ×©×‘×•×¢×™×ª</h4>
            <ul id="planWeek"></ul>
          </div>

          <div class="section">
            <h4>×“×’×œ×™× ××“×•××™× (×›×“××™ ×•×˜×¨×™× ×¨)</h4>
            <ul id="redFlags"></ul>
          </div>
        </div>
      </section>

      <!-- Right: Trailer / Hero -->
      <aside class="card hero">
        <div class="heroBg" aria-hidden="true"></div>

        <div class="eyesWrap" aria-hidden="true">
          <div class="eyes" id="eyes">
            <div class="eye"><div class="iris" id="irisL"><div class="pupil"></div><div class="shine"></div></div></div>
            <div class="eye"><div class="iris" id="irisR"><div class="pupil"></div><div class="shine"></div></div></div>
          </div>
        </div>

        <div class="inner">
          <h3>â€œ×œ×§×¨×•× ××ª ×”×—×ª×•×œ ×©×œ×š â€” ×‘×œ×™ × ×™×—×•×©×™×.â€</h3>
          <p class="sub">
            ×‘××§×•× ×¢×•×“ ×¨×©×™××ª ×˜×™×¤×™× ×›×œ×œ×™×ª â€” ××ª×” ××§×‘×œ ×¤×™×¨×•×© ×”×ª× ×”×’×•×ª×™ ×‘×¨×•×¨, ×¦×¢×“×™× ××“×•×™×§×™×,
            ×•×›×œ×™× ×œ×”×¤×—×ª×ª ×¡×˜×¨×¡ ×•×©×™×¤×•×¨ ×©×’×¨×”. (×¢× ××• ×‘×œ×™ ××•×–×™×§×” ×‘×¨×§×¢ ğŸ˜‰)
          </p>

          <div class="kpi" style="margin-top:14px">
            <div class="k">
              <div class="label">××™×§×•×“</div>
              <div class="val">×”×ª× ×”×’×•×ª</div>
            </div>
            <div class="k">
              <div class="label">×ª×•×¦××”</div>
              <div class="val">×©×§×˜ ×‘×‘×™×ª</div>
            </div>
            <div class="k">
              <div class="label">×’×™×©×”</div>
              <div class="val">×¦×¢×“×™× ×§×˜× ×™×</div>
            </div>
          </div>
        </div>

        <div class="heroFooter">
          <div class="badge"><span class="dot"></span>×¢×™× ×™×™× ×¢×•×§×‘×•×ª ××—×¨×™ ×”×¡××Ÿ</div>
          <div class="badge"><span class="dot" style="background:radial-gradient(circle at 35% 35%, rgba(255,255,255,.55), rgba(255,184,107,.85)); box-shadow:0 0 18px rgba(255,184,107,.22)"></span>Dark + Particles</div>
        </div>
      </aside>
    </main>

    <footer>
      <div class="fine">
        <div>×”×¢×¨×”: ×–×” ×›×œ×™ ×”×›×•×•× ×” ×›×œ×œ×™, ×œ× ×ª×—×œ×™×£ ×œ××‘×—×•×Ÿ ×•×˜×¨×™× ×¨×™. ×× ×™×© ×©×™× ×•×™ ×—×“ ×‘××›×™×œ×”/×©×ª×™×™×”, ×›××‘, ×“× ××• ×”×§××•×ª â€” ×¤×•× ×™× ×œ×•×˜×¨×™× ×¨.</div>
      </div>
    </footer>
  </div>

  <audio id="ambient" loop preload="metadata"></audio>

  <script>
    // =========================
    // Ambient audio (upload + controls)
    // =========================
    const ambient = document.getElementById('ambient');
    const audioFile = document.getElementById('audioFile');
    const playBtn = document.getElementById('playBtn');
    const muteBtn = document.getElementById('muteBtn');

    let isPlaying = false;
    let isMuted = false;

    // Default tiny synthy ambience (generated) fallback:
    // We'll create a very soft WebAudio drone if no file is loaded.
    let audioCtx, droneOsc, droneGain;
    function ensureDrone(){
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      droneOsc = audioCtx.createOscillator();
      const osc2 = audioCtx.createOscillator();
      const lfo = audioCtx.createOscillator();
      const lfoGain = audioCtx.createGain();
      droneGain = audioCtx.createGain();

      droneOsc.type = 'sine';
      droneOsc.frequency.value = 55;      // A1
      osc2.type = 'triangle';
      osc2.frequency.value = 110;         // A2

      lfo.type = 'sine';
      lfo.frequency.value = 0.08;         // slow movement
      lfoGain.gain.value = 0.18;

      lfo.connect(lfoGain);
      lfoGain.connect(droneGain.gain);

      droneGain.gain.value = 0.15;

      const merger = audioCtx.createGain();
      droneOsc.connect(merger);
      osc2.connect(merger);

      // gentle filter
      const filter = audioCtx.createBiquadFilter();
      filter.type = 'lowpass';
      filter.frequency.value = 320;
      filter.Q.value = 0.7;

      merger.connect(filter);
      filter.connect(droneGain);
      droneGain.connect(audioCtx.destination);

      droneOsc.start();
      osc2.start();
      lfo.start();
    }

    function setMute(m){
      isMuted = m;
      ambient.muted = m;
      muteBtn.textContent = m ? 'Unmute' : 'Mute';
      // Drone gain
      if (droneGain) droneGain.gain.value = m ? 0 : 0.15;
    }

    async function play(){
      // Browsers require user gesture; this is called from button click, OK.
      if (ambient.src){
        try{
          await ambient.play();
          isPlaying = true;
          playBtn.textContent = 'Pause';
        }catch(e){
          // fallback to drone
          ensureDrone();
          await audioCtx.resume();
          isPlaying = true;
          playBtn.textContent = 'Pause';
        }
      } else {
        ensureDrone();
        await audioCtx.resume();
        isPlaying = true;
        playBtn.textContent = 'Pause';
      }
    }

    function pause(){
      if (ambient.src) ambient.pause();
      if (audioCtx) audioCtx.suspend();
      isPlaying = false;
      playBtn.textContent = 'Play';
    }

    audioFile.addEventListener('change', () => {
      const f = audioFile.files && audioFile.files[0];
      if (!f) return;
      const url = URL.createObjectURL(f);
      ambient.src = url;
      ambient.volume = 0.35;
      // Auto-play after choosing file (still user gesture)
      play().then(()=>{}).catch(()=>{});
    });

    playBtn.addEventListener('click', async () => {
      if (!isPlaying) await play();
      else pause();
    });

    muteBtn.addEventListener('click', () => setMute(!isMuted));

    // Start muted by default (better UX); user can unmute.
    setMute(true);

    // =========================
    // Particles background
    // =========================
    const canvas = document.getElementById('fx');
    const ctx = canvas.getContext('2d', { alpha: true });
    const fxToggle = document.getElementById('fxToggle');

    let fxOn = true;
    let W = 0, H = 0, DPR = 1;
    const particles = [];
    const PCOUNT = 90;

    function resize(){
      DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = canvas.width = Math.floor(window.innerWidth * DPR);
      H = canvas.height = Math.floor(window.innerHeight * DPR);
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
    }
    window.addEventListener('resize', resize, { passive:true });
    resize();

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function seed(){
      particles.length = 0;
      for(let i=0;i<PCOUNT;i++){
        particles.push({
          x: rand(0,W),
          y: rand(0,H),
          r: rand(0.9*DPR, 2.4*DPR),
          vx: rand(-0.20, 0.20)*DPR,
          vy: rand(-0.12, 0.12)*DPR,
          a: rand(0.08, 0.24),
          tw: rand(0.002, 0.007),
          t: rand(0, 1000),
        });
      }
    }
    seed();

    function draw(){
      if (!fxOn){
        ctx.clearRect(0,0,W,H);
        requestAnimationFrame(draw);
        return;
      }
      ctx.clearRect(0,0,W,H);

      // lines when close
      for (let i=0;i<particles.length;i++){
        const p = particles[i];
        p.t += 1;
        p.x += p.vx;
        p.y += p.vy;
        if (p.x < -40) p.x = W+40;
        if (p.x > W+40) p.x = -40;
        if (p.y < -40) p.y = H+40;
        if (p.y > H+40) p.y = -40;

        const alpha = p.a + Math.sin(p.t*p.tw)*0.06;
        // dot
        ctx.beginPath();
        ctx.fillStyle = rgba(255,255,255,${alpha});
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        ctx.fill();
      }

      // connect
      for (let i=0;i<particles.length;i++){
        for (let j=i+1;j<particles.length;j++){
          const a = particles[i], b = particles[j];
          const dx = a.x-b.x, dy = a.y-b.y;
          const d2 = dx*dx+dy*dy;
          const maxD = 170*DPR;
          if (d2 < maxD*maxD){
            const d = Math.sqrt(d2);
            const t = 1 - (d/maxD);
            // subtle mix of two accents via opacity (without hard colors)
            ctx.strokeStyle = rgba(255,255,255,${0.10*t});
            ctx.lineWidth = 1*DPR;
            ctx.beginPath();
            ctx.moveTo(a.x,a.y);
            ctx.lineTo(b.x,b.y);
            ctx.stroke();
          }
        }
      }

      requestAnimationFrame(draw);
    }
    draw();

    function setFx(on){
      fxOn = on;
      fxToggle.classList.toggle('on', on);
      fxToggle.setAttribute('aria-checked', String(on));
    }
    fxToggle.addEventListener('click', ()=> setFx(!fxOn));
    fxToggle.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setFx(!fxOn); }
    });

    // =========================
    // Cat eyes follow cursor
    // =========================
    const irisL = document.getElementById('irisL');
    const irisR = document.getElementById('irisR');

    function moveIris(iris, eyeRect, mx, my){
      // clamp movement within eye bounds
      const cx = eyeRect.left + eyeRect.width/2;
      const cy = eyeRect.top + eyeRect.height/2;
      const dx = mx - cx;
      const dy = my - cy;
      const maxX = eyeRect.width * 0.18;
      const maxY = eyeRect.height * 0.18;

      const nx = Math.max(-maxX, Math.min(maxX, dx * 0.10));
      const ny = Math.max(-maxY, Math.min(maxY, dy * 0.10));
      iris.style.transform = translate(calc(-50% + ${nx}px), calc(-50% + ${ny}px));
    }

    window.addEventListener('mousemove', (e)=>{
      const eyes = document.querySelectorAll('.eye');
      if (eyes.length < 2) return;
      moveIris(irisL, eyes[0].getBoundingClientRect(), e.clientX, e.clientY);
      moveIris(irisR, eyes[1].getBoundingClientRect(), e.clientX, e.clientY);
    }, { passive:true });

    // =========================
    // Analyzer logic (rule-based)
    // =========================
    const issue = document.getElementById('issue');
    const age = document.getElementById('age');
    const home = document.getElementById('home');
    const others = document.getElementById('others');
    const details = document.getElementById('details');

    const analyzeBtn = document.getElementById('analyzeBtn');
    const resetBtn = document.getElementById('resetBtn');
    const demoBtn = document.getElementById('demoBtn');

    const resultBox = document.getElementById('resultBox');
    const diagTop = document.getElementById('diagTop');
    const urgency = document.getElementById('urgency');
    const confidence = document.getElementById('confidence');
    const chips = document.getElementById('chips');
    const meaning = document.getElementById('meaning');
    const plan72 = document.getElementById('plan72');
    const planWeek = document.getElementById('planWeek');
    const redFlags = document.getElementById('redFlags');

    function li(arr, el){
      el.innerHTML = '';
      arr.forEach(t=>{
        const x = document.createElement('li');
        x.textContent = t;
        el.appendChild(x);
      });
    }

    function mkChips(list){
      chips.innerHTML = '';
      list.forEach(t=>{
        const c = document.createElement('span');
        c.className = 'chip';
        c.textContent = t;
        chips.appendChild(c);
      });
    }

    function scoreModel(){
      const s = {
        "Overstimulation ×‘×–××Ÿ ×œ×™×˜×•×£": 0,
        "×—×•×¡×¨ ×”×¢×©×¨×”/×× ×¨×’×™×” ×œ× ×× ×•×§×–×ª": 0,
        "×¡×˜×¨×¡ ×¡×‘×™×‘×ª×™/×©×™× ×•×™×™×": 0,
        "×§×•× ×¤×œ×™×§×˜/×˜×¨×™×˜×•×¨×™×” ××•×œ ×—×™×•×ª ××—×¨×•×ª": 0,
        "×‘×¢×™×” ×¨×¤×•××™×ª ××¤×©×¨×™×ª": 0,
        "×‘×¢×™×” ×‘××¨×’×–/×”×¢×“×¤×•×ª ××¦×¢": 0,
        "×©×’×¨×” ×œ× × ×›×•× ×” ×œ×¤× ×™ ×©×™× ×”": 0
      };

      const i = issue.value, a = age.value, h = home.value, o = others.value;
      const text = (details.value || '').toLowerCase();

      // Baseline by issue
      if (i === 'bite'){
        s["Overstimulation ×‘×–××Ÿ ×œ×™×˜×•×£"] += 4;
        s["×—×•×¡×¨ ×”×¢×©×¨×”/×× ×¨×’×™×” ×œ× ×× ×•×§×–×ª"] += 2;
        if (a === 'kitten') s["×—×•×¡×¨ ×”×¢×©×¨×”/×× ×¨×’×™×” ×œ× ×× ×•×§×–×ª"] += 2;
        if (text.includes('×¤×ª××•×') || text.includes('××—×¨×™') || text.includes('10') || text.includes('×©× ×™×•×ª')) s["Overstimulation ×‘×–××Ÿ ×œ×™×˜×•×£"] += 2;
      }

      if (i === 'night'){
        s["×©×’×¨×” ×œ× × ×›×•× ×” ×œ×¤× ×™ ×©×™× ×”"] += 4;
        s["×—×•×¡×¨ ×”×¢×©×¨×”/×× ×¨×’×™×” ×œ× ×× ×•×§×–×ª"] += 3;
        if (a === 'kitten') s["×—×•×¡×¨ ×”×¢×©×¨×”/×× ×¨×’×™×” ×œ× ×× ×•×§×–×ª"] += 2;
        if (text.includes('×œ×™×œ×”') || text.includes('×¨×¥') || text.includes('××©×—×§')) s["×©×’×¨×” ×œ× × ×›×•× ×” ×œ×¤× ×™ ×©×™× ×”"] += 1;
      }

      if (i === 'litter'){
        s["×‘×¢×™×” ×‘××¨×’×–/×”×¢×“×¤×•×ª ××¦×¢"] += 4;
        s["×¡×˜×¨×¡ ×¡×‘×™×‘×ª×™/×©×™× ×•×™×™×"] += 2;
        s["×‘×¢×™×” ×¨×¤×•××™×ª ××¤×©×¨×™×ª"] += 3; // always consider
        if (a === 'senior') s["×‘×¢×™×” ×¨×¤×•××™×ª ××¤×©×¨×™×ª"] += 2;
        if (text.includes('×“×') || text.includes('×›××‘') || text.includes('××™×™×œ×œ')) s["×‘×¢×™×” ×¨×¤×•××™×ª ××¤×©×¨×™×ª"] += 4;
      }

      if (i === 'aggression'){
        s["×§×•× ×¤×œ×™×§×˜/×˜×¨×™×˜×•×¨×™×” ××•×œ ×—×™×•×ª ××—×¨×•×ª"] += 4;
        s["×¡×˜×¨×¡ ×¡×‘×™×‘×ª×™/×©×™× ×•×™×™×"] += 2;
        if (o !== 'none') s["×§×•× ×¤×œ×™×§×˜/×˜×¨×™×˜×•×¨×™×” ××•×œ ×—×™×•×ª ××—×¨×•×ª"] += 2;
      }

      if (i === 'stress'){
        s["×¡×˜×¨×¡ ×¡×‘×™×‘×ª×™/×©×™× ×•×™×™×"] += 4;
        s["×‘×¢×™×” ×¨×¤×•××™×ª ××¤×©×¨×™×ª"] += 2;
        if (text.includes('×œ× ××•×›×œ') || text.includes('×œ× ××•×›×œ×ª') || text.includes('×”×§×™×')) s["×‘×¢×™×” ×¨×¤×•××™×ª ××¤×©×¨×™×ª"] += 3;
      }

      if (i === 'scratch'){
        s["×—×•×¡×¨ ×”×¢×©×¨×”/×× ×¨×’×™×” ×œ× ×× ×•×§×–×ª"] += 3;
        s["×¡×˜×¨×¡ ×¡×‘×™×‘×ª×™/×©×™× ×•×™×™×"] += 1;
        if (h === 'small') s["×—×•×¡×¨ ×”×¢×©×¨×”/×× ×¨×’×™×” ×œ× ×× ×•×§×–×ª"] += 2;
      }

      // Environment modifiers
      if (h === 'small') s["×—×•×¡×¨ ×”×¢×©×¨×”/×× ×¨×’×™×” ×œ× ×× ×•×§×–×ª"] += 1;
      if (o === 'multi') { s["×§×•× ×¤×œ×™×§×˜/×˜×¨×™×˜×•×¨×™×” ××•×œ ×—×™×•×ª ××—×¨×•×ª"] += 2; s["×¡×˜×¨×¡ ×¡×‘×™×‘×ª×™/×©×™× ×•×™×™×"] += 1; }

      // Text hints
      if (text.includes('×—×“×©') || text.includes('××¢×‘×¨') || text.includes('×©×™×¤×•×¥')) s["×¡×˜×¨×¡ ×¡×‘×™×‘×ª×™/×©×™× ×•×™×™×"] += 2;
      if (text.includes('××¨×’×–') || text.includes('×—×•×œ') || text.includes('×¨×™×—')) s["×‘×¢×™×” ×‘××¨×’×–/×”×¢×“×¤×•×ª ××¦×¢"] += 2;

      // pick top
      const entries = Object.entries(s).sort((a,b)=>b[1]-a[1]);
      const top = entries[0];
      const second = entries[1];

      const total = entries.reduce((sum, [,v])=>sum+v, 0) || 1;
      const conf = Math.round((top[1]/total)*100);

      // urgency
      let urg = "× ××•×›×”";
      let urgClass = "ok";
      if (i === 'litter' || s["×‘×¢×™×” ×¨×¤×•××™×ª ××¤×©×¨×™×ª"] >= 5){
        urg = "×‘×™× ×•× ×™×ªâ€“×’×‘×•×”×”";
        urgClass = "bad";
      }
      if ((details.value || '').includes('×“×') || (details.value || '').includes('×›××‘')){
        urg = "×’×‘×•×”×”";
        urgClass = "bad";
      }

      return { top, second, conf, urg, urgClass, scores: entries };
    }

    function buildOutput(model){
      const i = issue.value;

      // Display headline
      diagTop.textContent = model.top[0];
      urgency.textContent = model.urg;
      urgency.className = 'val ' + (model.urgClass === 'bad' ? 'bad' : 'ok');
      confidence.textContent = model.conf + '%';

      // chips
      const tags = [];
      tags.push("×’×™×œ: " + (age.value==='kitten'?'×’×•×¨':age.value==='adult'?'×‘×•×’×¨':'××‘×•×’×¨'));
      tags.push("×¡×‘×™×‘×”: " + (home.value==='small'?'×“×™×¨×” ×§×˜× ×”':home.value==='apt'?'×“×™×¨×”':'×‘×™×ª+×—×¦×¨'));
      tags.push("×¢×•×“ ×—×™×•×ª: " + (others.value==='none'?'×œ×':others.value==='cat'?'×—×ª×•×œ × ×•×¡×£':others.value==='dog'?'×›×œ×‘':'×›××” ×—×™×•×ª'));
      tags.push("××¤×©×¨×•×ª ×©× ×™×™×”: " + model.second[0]);
      mkChips(tags);

      // Meaning + plans by top diagnosis
      let meaningTxt = "";
      let plan72Arr = [];
      let planWeekArr = [];
      let flags = [
        "×™×¨×™×“×” ×—×“×” ×‘××›×™×œ×”/×©×ª×™×™×” ×œ×™×•×ª×¨ ×-24 ×©×¢×•×ª",
        "×“× ×‘×©×ª×Ÿ/×¦×•××”, ××××¥ ×•×›××‘ ×‘×©×™×¨×•×ª×™×",
        "×”×§××•×ª/×©×œ×©×•×œ ××ª××©×š",
        "×›××‘ ×‘×¨×•×¨, ×¦×œ×™×¢×”, ××• ××¤×ª×™×” ×—×¨×™×’×”"
      ];

      const topKey = model.top[0];

      if (topKey.includes("Overstimulation")){
        meaningTxt = "× ×©×™×›×” ×‘×–××Ÿ ×œ×™×˜×•×£ ×”×™× ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª '×¢×•××¡ ×—×•×©×™' â€” ×”×—×ª×•×œ × ×”× ×”, ×•××– ××’×™×¢ ×œ×¡×£. ×¡×™×× ×™× ××§×“×™××™×: ×–× ×‘ ××¦×œ×™×£, ×¢×•×¨ ××ª×›×•×•×¥, ××•×–× ×™×™× ×œ××—×•×¨, ××‘×˜ ×—×“.";
        plan72Arr = [
          "×œ×¢×‘×•×¨ ×œ×œ×™×˜×•×£ ×§×¦×¨ ×××•×“ (2â€“5 ×©× ×™×•×ª) ×•×œ×”×¤×¡×™×§ ×œ×¤× ×™ ×”×¡×™××Ÿ ×”×¨××©×•×Ÿ.",
          "×œ×”×—×œ×™×£ ×œ'×¤×¨×¡ ×¢×œ ×¨×•×’×¢' â€” ×—×˜×™×£ ×§×˜×Ÿ ××—×¨×™ ×¢×¦×™×¨×” ×™×–×•××”.",
          "×œ×”×™×× ×¢ ××œ×™×˜×•×£ ×‘××–×•×¨×™× ×©××¦×™×ª×™× ×ª×’×•×‘×” (×‘×˜×Ÿ/×’×‘ ×ª×—×ª×•×Ÿ) ×‘×©×œ×‘ ×¨××©×•×Ÿ.",
          "×œ×”×•×¡×™×£ 2 ×¡×©× ×™× ×§×¦×¨×™× ×©×œ ××©×—×§ ×¢× ×—×›×” (5â€“7 ×“×§×³) ×‘×™×•×."
        ];
        planWeekArr = [
          "×œ×”××¨×™×š ×œ×™×˜×•×£ ×‘×”×“×¨×’×”: 5â†’8â†’12 ×©× ×™×•×ª ×¨×§ ×× ××™×Ÿ ×¡×™×× ×™× ××§×“×™××™×.",
          "×œ×‘× ×•×ª '×©×’×¨×ª ××©×—×§-××•×›×œ-×× ×•×—×”' ×‘××™×•×—×“ ×‘×¢×¨×‘.",
          "×œ×”×•×¡×™×£ ××©×˜×— ×’×™×¨×•×“ ××™×›×•×ª×™/××ª×§×Ÿ ×˜×™×¤×•×¡ ×›×“×™ ×œ×¤×¨×•×§ ×× ×¨×’×™×”.",
          "×× ×™×© ×™×œ×“×™× â€” ×œ×œ××“ '×œ× ×œ×”×—×–×™×§/×œ×—×‘×§' ×¢×“ ×©×”×”×ª× ×”×’×•×ª × ×¨×’×¢×ª."
        ];
      }

      if (topKey.includes("×©×’×¨×” ×œ× × ×›×•× ×”")){
        meaningTxt = "×—×ª×•×œ×™× ×”× ×¦×™×™×“×™× â€” ×× ×œ× ×¤×¨×§×ª ×× ×¨×’×™×” ×‘×¢×¨×‘, ×”× '×¤×•×ª×—×™× ××©××¨×ª' ×‘×œ×™×œ×”. ×œ×¨×•×‘ ×–×” ×©×™×œ×•×‘ ×©×œ ×©×¢××•× + ×”×¨×’×œ×™× ×©××—×–×§×™× ×™×œ×œ×•×ª (×§××™× ××œ×™×”×/×××›×™×œ×™×).";
        plan72Arr = [
          "×©×¢×ª×™×™× ×œ×¤× ×™ ×©×™× ×”: ××©×—×§ ××™× ×˜× ×¡×™×‘×™ 10â€“15 ×“×§×³ (×—×›×”/××¨×“×£ ××‘×•×§×¨).",
          "××—×¨×™ ×”××©×—×§: ××¨×•×—×” ×§×˜× ×” (××“××” '×¦×™×“â†’××›×™×œ×”â†’×©×™× ×”').",
          "×œ× ×œ×§×•× ×œ×™×œ×œ×•×ª. ×× ×—×™×™×‘×™× â€” ××™× ×™××•× ××™× ×˜×¨××§×¦×™×”, ×‘×œ×™ ××•×›×œ.",
          "×œ×”×©××™×¨ ×¦×¢×¦×•×¢×™ '×—×™×¤×•×© ××–×•×Ÿ' (puzzle feeder) ×œ×œ×™×œ×”."
        ];
        planWeekArr = [
          "×œ×§×‘×¢ 2 ××©×—×§×™× ×‘×™×•× (×‘×•×§×¨ ×§×¦×¨ + ×¢×¨×‘ ××¨×•×š).",
          "×œ×”×•×¨×™×“ ×—×™×–×•×§×™× ×œ×™×œ×™×™× ×‘×”×“×¨×’×” (×¢×§×‘×™×•×ª = ×§×¡×).",
          "×œ×”×•×¡×™×£ ×’×™×¨×•×™ ×¡×‘×™×‘×ª×™: ×—×œ×•×Ÿ ×ª×¦×¤×™×ª, ××“×£ ×˜×™×¤×•×¡, ×§×¨×˜×•× ×™×.",
          "×× ××“×•×‘×¨ ×‘×—×ª×•×œ ×‘×•×’×¨ ××¡×•×¨×¡ â€” ×œ×‘×“×•×§ ×¨×•×˜×™× ×”/×¡×˜×¨×¡ ×•×œ× ×¨×§ '×× ×¨×’×™×”'."
        ];
      }

      if (topKey.includes("×‘×¢×™×” ×‘××¨×’×–")){
        meaningTxt = "×¢×©×™×™×ª ×¦×¨×›×™× ××—×•×¥ ×œ××¨×’×– ××ª×—×œ×§×ª ×œ×©× ×™×™×: ×‘×¢×™×™×ª ××¨×’×– (××¦×¢/× ×™×§×™×•×Ÿ/××™×§×•×/×›××•×ª) ××• ×œ×—×¥, ×•×œ×¢×™×ª×™× ×’× ×¢× ×™×™×Ÿ ×¨×¤×•××™. ×—×©×•×‘ ×œ×ª×§×Ÿ ××ª ×”×¡×˜××¤ ××”×¨ â€” ×œ×¤× ×™ ×©×–×” ××ª×§×‘×¢ ×œ×”×¨×’×œ.";
        plan72Arr = [
          "×›×œ×œ ××¦×‘×¢: ××¡×¤×¨ ××¨×’×–×™× = ××¡×¤×¨ ×—×ª×•×œ×™× + 1.",
          "×œ×”×¦×™×‘ ××¨×’×– × ×•×¡×£ ×‘××§×•× ×©×§×˜ ×•× ×’×™×© (×œ× ×œ×™×“ ××›×•× ×ª ×›×‘×™×¡×”/×¨×¢×©).",
          "×œ× ×§×•×ª ××“×™ ×™×•×. ×œ×”×—×œ×™×£ ××¦×¢ ×× ×™×© ×¨×™×— ×—×–×§/××‘×§ ×©××¤×¨×™×¢.",
          "×œ×”×™×× ×¢ ××¢× ×™×©×” â€” ×–×” ×¨×§ ××’×‘×™×¨ ×¡×˜×¨×¡ ×•××—××™×¨."
        ];
        planWeekArr = [
          "×œ×‘×“×•×§ ×¡×•×’ ××¦×¢: ×”×¨×‘×” ×—×ª×•×œ×™× ××¢×“×™×¤×™× ×—×•×œ ×¢×“×™×Ÿ ×œ×œ× ×‘×™×©×•×.",
          "×œ×”×’×“×™×œ ××¨×’×– (×‘××™×•×—×“ ×œ×—×ª×•×œ×™× ×’×“×•×œ×™×/××‘×•×’×¨×™×).",
          "×œ×”×•×¡×™×£ ×¤×¨×•××•× ×™× (Feliway) ×× ×™×© ×¡×˜×¨×¡ ×‘×‘×™×ª.",
          "×× ×™×© ××××¥/×›××‘/×“× â€” ×œ×§×‘×•×¢ ×•×˜×¨×™× ×¨ ×‘×”×§×“×."
        ];
        flags.unshift("×”×©×ª× ×” ×ª×›×•×¤×” ×¢× ××¢×˜ ×©×ª×Ÿ/××××¥ â€” ×¢×œ×•×œ ×œ×”×™×•×ª ×“×—×•×£ (×‘×¢×™×§×¨ ×–×›×¨×™×).");
      }

      if (topKey.includes("×§×•× ×¤×œ×™×§×˜/×˜×¨×™×˜×•×¨×™×”")){
        meaningTxt = "×ª×•×§×¤× ×•×ª ×”×™× ×”×¨×‘×” ×¤×¢××™× ×ª×—×¨×•×ª ×¢×œ ××©××‘×™× (××–×•×Ÿ, ××§×•××•×ª ××¡×ª×•×¨, ××¨×’×–×™×) ××• ××¤×’×© ××”×™×¨ ××“×™ ×‘×™×Ÿ ×—×™×•×ª. ×¦×¨×™×š ×œ×‘× ×•×ª '×”×™×›×¨×•×ª ××—×“×©' ×•×œ×¢×¦×‘ ×˜×¨×™×˜×•×¨×™×” ×—×›××”.";
        plan72Arr = [
          "×œ×”×¤×¨×™×“ ×–×× ×™×ª ×× ×™×© ×¢×™××•×ª×™× â€” ×‘×˜×™×—×•×ª ×œ×¤× ×™ ×”×›×•×œ.",
          "×œ×”×•×¡×™×£ ××©××‘×™× ×›×¤×•×œ×™×: ××™×/××•×›×œ/××¨×’×–×™×/××§×•××•×ª ×’×‘×•×”×™×.",
          "××¤×’×©×™× ×§×¦×¨×™× ×¢× ×—×™×–×•×§ ×—×™×•×‘×™ (×—×˜×™×¤×™×/××©×—×§) ×“×¨×š ××¨×—×§.",
          "×œ××¤×©×¨ × ×ª×™×‘×™ ××™×œ×•×˜ (××“×¤×™×, ××¢×‘×¨ ×¤×ª×•×—) ×›×“×™ ×©×œ× ×™×™×ª×§×¢×•."
        ];
        planWeekArr = [
          "×¢×‘×•×“×” ×”×“×¨×’×ª×™×ª: ×¨×™×—â†’×¨××™×™×”â†’×§×¨×‘×” â€” ×‘×œ×™ ×œ×§×¤×•×¥ ×©×œ×‘×™×.",
          "×œ×”××›×™×œ ×‘××§×‘×™×œ ×‘××¨×—×§ ×‘×˜×•×— ×›×“×™ ×œ×™×¦×•×¨ ××¡×•×¦×™××¦×™×” ×—×™×•×‘×™×ª.",
          "×œ×©×§×•×œ ×™×™×¢×•×¥ ×”×ª× ×”×’×•×ª×™ ×× ×™×© × ×©×™×›×•×ª ×××™×ª×™×•×ª/×¤×¦×™×¢×•×ª.",
          "×× ××“×•×‘×¨ ×‘×ª×•×§×¤× ×•×ª ×¤×ª××•××™×ª ××¦×œ ×—×ª×•×œ ×‘×•×’×¨ â€” ×œ×‘×“×•×§ ×›××‘/×¨×¤×•××™."
        ];
      }

      if (topKey.includes("×¡×˜×¨×¡ ×¡×‘×™×‘×ª×™")){
        meaningTxt = "×—×ª×•×œ×™× ××’×™×‘×™× ×œ×©×™× ×•×™×™× ×§×˜× ×™×: ××•×¨×—×™×, ×¨×™×—×•×ª, ××¢×‘×¨ ×“×™×¨×”, ×¢×‘×•×“×•×ª ×‘×‘×™×ª. ×¡×˜×¨×¡ × ×¨××” ×›××• ×”×¡×ª×ª×¨×•×ª, ××™×¢×•×˜ ××©×—×§, ×œ×™×§×•×§ ×™×ª×¨, ××• ×©×™× ×•×™ ×©×™×¨×•×ª×™×.";
        plan72Arr = [
          "×œ×™×¦×•×¨ '××–×•×¨ ×‘×˜×•×—' ××—×“: ××™×, ××•×›×œ, ××¨×’×–, ××—×‘×•×, ×‘×œ×™ ×”×¤×¨×¢×•×ª.",
          "×œ×”×§×˜×™×Ÿ ×’×™×¨×•×™×™× (×¨×¢×©/×“×œ×ª×•×ª ×˜×¨×™×§×”) ×•×œ×”×§×¤×™×“ ×¢×œ ×©×’×¨×”.",
          "×œ×”×•×¡×™×£ ××§×•××•×ª ×’×‘×•×”×™× ×•××—×‘×•××™× (×§×¨×˜×•×Ÿ ×¢×•×‘×“ ××¦×•×™×Ÿ).",
          "×œ×”×¤×¢×™×œ ××©×—×§ ×§×¦×¨ ×¤×¢××™×™× ×‘×™×•× â€” ×‘×œ×™ ×œ×”×›×¨×™×—."
        ];
        planWeekArr = [
          "×œ×”×¤×¢×™×œ ×¤×¨×•××•× ×™× ×‘×‘×™×ª ×•×œ×‘×—×•×Ÿ ×”×©×¤×¢×”.",
          "×œ×”×—×–×™×¨ ×©×œ×™×˜×” ×œ×—×ª×•×œ: ××¤×©×¨×•×™×•×ª (××™×¤×” ×œ×©×‘×ª/×œ×”×ª×—×‘×/×œ××›×•×œ).",
          "×œ××“×•×“ ×”×ª×§×“××•×ª ×™×•××™×ª: ××•×›×œ, ×©×™×¨×•×ª×™×, ××©×—×§, ××™× ×˜×¨××§×¦×™×”.",
          "×× ××™×Ÿ ×©×™×¤×•×¨ ×ª×•×š ×©×‘×•×¢ ××• ×™×© ×”×™×“×¨×“×¨×•×ª â€” ×•×˜×¨×™× ×¨."
        ];
      }

      if (topKey.includes("×‘×¢×™×” ×¨×¤×•××™×ª")){
        meaningTxt = "×›×©×™×© ×©×™× ×•×™ ×”×ª× ×”×’×•×ª ×—×“ (×‘××™×•×—×“ ×©×™×¨×•×ª×™×/××›×™×œ×”/×›××‘) ×ª××™×“ ××©××™×¨×™× ××§×•× ×œ×¨×¤×•××™. ×”××ª×¨ ×™×›×•×œ ×œ×›×•×•×Ÿ, ××‘×œ ×›××Ÿ ×¢×“×™×£ ×‘×“×™×§×” ××§×¦×•×¢×™×ª.";
        plan72Arr = [
          "×œ×‘×“×•×§ ×©×ª×™×™×”/××›×™×œ×” ×•×©×™×¨×•×ª×™× (×ª×“×™×¨×•×ª, ××××¥, ×›××‘).",
          "×œ×”×¦×™×¢ ××–×•×Ÿ ×¨×˜×•×‘ ×•××™× ×˜×¨×™×™× ×‘×›××” × ×§×•×“×•×ª ×‘×‘×™×ª.",
          "×œ×©××•×¨ ×“×’×™××ª ×©×ª×Ÿ/×¦×™×œ×•× ×•×™×“××• ×©×œ ×”×”×ª× ×”×’×•×ª ×× ××¤×©×¨.",
          "×œ×§×‘×•×¢ ×•×˜×¨×™× ×¨ ×× ×™×© ××××¥/×“×/×›××‘ ××• ×™×¨×™×“×” ×—×“×” ×‘××›×™×œ×”."
        ];
        planWeekArr = [
          "×œ× '×œ×—×›×•×ª ×©×™×¢×‘×•×¨' ×× ×”×¡×™×× ×™× × ××©×›×™×.",
          "×œ×”×¤×—×™×ª ×¡×˜×¨×¡ ×‘×–××Ÿ ×”××ª× ×”: ××–×•×¨ ×©×§×˜ + ×©×’×¨×” ×§×‘×•×¢×”.",
          "×œ× ×”×œ ×™×•××Ÿ ×§×¦×¨ (××ª×™, ×›××”, ××™×¤×”) â€” ×–×” ×¢×•×–×¨ ×œ××‘×—×•×Ÿ.",
          "×œ×”×ª××™× ×¡×‘×™×‘×ª ××¨×’×–/××–×•×Ÿ ×œ×¤×™ ×”××œ×¦×ª ×•×˜×¨×™× ×¨."
        ];
        flags = [
          "×“×, ×›××‘, ××××¥ ×‘×©×ª×Ÿ/×¦×•××” â€” ××™×™×“×™",
          "×—×ª×•×œ ×–×›×¨ ×©×× ×¡×” ×œ×”×©×ª×™×Ÿ ×•×œ× ××¦×œ×™×— â€” ×“×—×•×£ ×××•×“",
          "××›×™×œ×”/×©×ª×™×™×” ×›××¢×˜ ××¤×¡ 24 ×©×¢×•×ª",
          "×§×•×¦×¨ × ×©×™××”, ×—×•×œ×©×” ×§×™×¦×•× ×™×ª, ×—×•×"
        ];
      }

      // If user selected scratch but top isn't directly matching, add scratch pointers
      if (issue.value === 'scratch' && !planWeekArr.some(x=>x.includes('×’×™×¨×•×“'))){
        plan72Arr.unshift("×œ×”×¦×™×‘ ××©×˜×— ×’×™×¨×•×“ ×™×¦×™×‘ ×œ×™×“ ××–×•×¨ ×”×©×¨×™×˜×” ×”××”×•×‘, ×•×œ×ª×’××œ ×©×™××•×© × ×›×•×Ÿ.");
        planWeekArr.unshift("×œ×©×—×§ ×œ×™×“ ××©×˜×— ×”×’×™×¨×•×“ ×•××– ×œ×”× ×™×— ×—×˜×™×£ ×¢×œ×™×• ×›×“×™ ×œ×—×–×§ ×”×ª× ×”×’×•×ª ×¨×¦×•×™×”.");
      }

      meaning.textContent = meaningTxt;
      li(plan72Arr, plan72);
      li(planWeekArr, planWeek);
      li(flags, redFlags);

      resultBox.classList.add('show');
      // Smooth scroll to results on mobile
      resultBox.scrollIntoView({ behavior:'smooth', block:'start' });
    }

    analyzeBtn.addEventListener('click', ()=>{
      const model = scoreModel();
      buildOutput(model);
    });

    resetBtn.addEventListener('click', ()=>{
      issue.value = 'bite';
      age.value = 'adult';
      home.value = 'apt';
      others.value = 'none';
      details.value = '';
      resultBox.classList.remove('show');
    });

    demoBtn.addEventListener('click', ()=>{
      issue.value = 'bite';
      age.value = 'adult';
      home.value = 'apt';
      others.value = 'none';
      details.value = '×”×•× × ×•×©×š ××—×¨×™ ×›××” ×©× ×™×•×ª ×œ×™×˜×•×£, ×‘×¢×™×§×¨ ×‘×¢×¨×‘.';
      const model = scoreModel();
      buildOutput(model);
    });

    // Optional: start particles off for low-power devices
    // (keep on by default; user can toggle)
  </script>
</body>
</html>
